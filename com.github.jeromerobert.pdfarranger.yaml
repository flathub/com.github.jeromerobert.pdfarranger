id: com.github.jeromerobert.pdfarranger
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk
command: pdfarranger

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --filesystem=host

modules:
  - shared-modules/intltool/intltool-0.51.json

  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_UTILS=OFF
      - -DENABLE_CPP=OFF
      - -DENABLE_QT5=OFF
      - -DENABLE_BOOST=OFF
    sources:
      - url: https://poppler.freedesktop.org/poppler-22.09.0.tar.xz
        sha256: d7a8f748211359cadb774ba3e18ecda6464b34027045c0648eb30d5852a41e2e
        type: archive
        x-checker-data:
          type: anitya
          project-id: 3686
          stable-only: true
          url-template: https://poppler.freedesktop.org/poppler-$version.tar.xz

  - name: python-distutils-extra
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST}
        .
    sources:
      - url: https://launchpad.net/python-distutils-extra/trunk/2.39/+download/python-distutils-extra-2.39.tar.gz
        sha256: 723f24f4d65fc8d99b33a002fbbb3771d4cc9d664c97085bf37f3997ae8063af
        type: archive
        x-checker-data:
          type: anitya
          project-id: 3827
          stable-only: true
          url-template: https://launchpad.net/python-distutils-extra/trunk/$version/+download/python-distutils-extra-$version.tar.gz

  - name: pikepdf-src
    buildsystem: simple
    build-options:
      env:
        SETUPTOOLS_USE_DISTUTILS: stdlib
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST}
    sources:
      - url: https://files.pythonhosted.org/packages/4a/0b/29c9d91186861472a6594083a4da2683febab57ada2b62c414f5d7cbefcf/pikepdf-6.0.2.tar.gz
        sha256: eab4823438a95b849699de02cb8780d4853b0c9de89548dd1ff4e3327371d7d4
        type: archive
        x-checker-data:
          type: pypi
          name: pikepdf
          versions:
            - <: 6

    modules:
      - python3-lxml.json
      - python3-pikepdf-deps.json
      - name: qpdf
        buildsystem: cmake-ninja
        builddir: true
        sources:
          - url: https://github.com/qpdf/qpdf/releases/download/v11.1.0/qpdf-11.1.0.tar.gz
            sha256: 34a7cf3ac6e239510e9a20d7cbe10a4aff0f572c20e0a9bed0badb820a69e22d
            type: archive
            x-checker-data:
              type: anitya
              project-id: 5542
              stable-only: true
              url-template: https://github.com/qpdf/qpdf/releases/download/v$version/qpdf-$version.tar.gz
              versions:
                - <: 11

  - name: image2pdf
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST}
        img2pdf-*.tar.gz
    sources:
      - url: https://files.pythonhosted.org/packages/95/b5/f933f482a811fb9a7b3707f60e28f2925fed84726e5a6283ba07fdd54f49/img2pdf-0.4.4.tar.gz
        sha256: 8ec898a9646523fd3862b154f3f47cd52609c24cc3e2dc1fb5f0168f0cbe793c
        type: file
        x-checker-data:
          type: pypi
          name: img2pdf

  - python3-python-dateutil.json
  - name: pdfarranger
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST}
        .
    sources:
      - url: https://github.com/pdfarranger/pdfarranger
        commit: 815c9e6c008e1afa59ffbdf79eaeb27a52c96d79
        tag: 1.9.0
        type: git
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$


cleanup:
  - /include
  - /lib/pkgconfig
  - /app/bin/opj_*
