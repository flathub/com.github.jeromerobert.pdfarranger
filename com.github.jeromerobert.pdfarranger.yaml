---
id: com.github.jeromerobert.pdfarranger
runtime: org.gnome.Platform
runtime-version: '3.36'
sdk: org.gnome.Sdk
command: pdfarranger

finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --filesystem=home

modules:
  - shared-modules/intltool/intltool-0.51.json
  - shared-modules/openjpeg/openjpeg.json # dependency of poppler

  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_UTILS=OFF
      - -DENABLE_CPP=OFF
      - -DENABLE_QT5=OFF
    sources:
      - url: https://poppler.freedesktop.org/poppler-0.88.0.tar.xz
        sha256: b4453804e9a5a519e6ceee0ac8f5efc229e3b0bf70419263c239124474d256c7
        type: archive

  - name: python-distutils-extra
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} .
    sources:
      - url: https://launchpad.net/python-distutils-extra/trunk/2.39/+download/python-distutils-extra-2.39.tar.gz
        sha256: 723f24f4d65fc8d99b33a002fbbb3771d4cc9d664c97085bf37f3997ae8063af
        type: archive

  - name: pikepdf
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} lxml-*.whl pikepdf-*.whl
    sources:
      - url: https://files.pythonhosted.org/packages/36/d2/e6967d9fba37a1546a2df8b399507309d1e574664ce3960e064cde338b80/pikepdf-1.13.0-cp37-cp37m-manylinux2010_x86_64.whl
        sha256: 641f9f420bf6fd421d6dcb5a4b8484e992d349af2fa0dbbd5af78c4b84ee14e8
        type: file
      - url: https://files.pythonhosted.org/packages/85/9e/93e2c3af278c7c8b6826666bbcb145af2829bd761c3b329e51cd6343836c/lxml-4.5.0-cp37-cp37m-manylinux1_x86_64.whl
        sha256: fd52e796fee7171c4361d441796b64df1acfceb51f29e545e812f16d023c4bbc
        type: file

  - name: pdfarranger
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} .
    sources:
      - url: https://github.com/jeromerobert/pdfarranger
        tag: 1.5.3
        commit: 5cfcf50d66f6f132a849ab4e826798e833e61225
        type: git

cleanup:
  - /include
  - /lib/pkgconfig
  - /app/lib/openjpeg-2.3
  - /app/bin/opj_*
