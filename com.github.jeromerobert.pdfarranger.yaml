---
id: com.github.jeromerobert.pdfarranger
runtime: org.gnome.Platform
runtime-version: '3.36'
sdk: org.gnome.Sdk
command: pdfarranger

finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --filesystem=home

modules:
  - shared-modules/intltool/intltool-0.51.json
  - shared-modules/openjpeg/openjpeg.json # dependency of poppler

  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_UTILS=OFF
      - -DENABLE_CPP=OFF
      - -DENABLE_QT5=OFF
    sources:
      - url: https://poppler.freedesktop.org/poppler-0.90.1.tar.xz
        sha256: 984d82e72e91418d280885298c8bdc855a2fd92665fd52a1345b27235e0c71c4
        type: archive

  - name: python-distutils-extra
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} .
    sources:
      - url: https://launchpad.net/python-distutils-extra/trunk/2.39/+download/python-distutils-extra-2.39.tar.gz
        sha256: 723f24f4d65fc8d99b33a002fbbb3771d4cc9d664c97085bf37f3997ae8063af
        type: archive

  - name: pikepdf
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} lxml-*.whl pikepdf-*.whl Pillow-*.whl
    sources:
      - url: https://files.pythonhosted.org/packages/50/d4/de2e3a2a0d856a6d80ad2d58e76b11325fa9d3eb7749f69cb3e3cc797def/pikepdf-1.17.1-cp37-cp37m-manylinux2010_x86_64.whl
        sha256: b59c1558ddf99fe2ba7d03bc2d8873653452ba89c0d5d170ef1092949a785fce
        type: file
      - url: https://files.pythonhosted.org/packages/de/3c/fa420469c0d4f62ae39f19ee6505f90d00ae469f6264f4f54e61ed9d9a2c/lxml-4.5.2-cp37-cp37m-manylinux1_x86_64.whl
        sha256: a76979f728dd845655026ab991df25d26379a1a8fc1e9e68e25c7eda43004bed
        type: file
      - url: https://files.pythonhosted.org/packages/e8/f2/6722dd0c22e3a143ac792ccb2424924ac72af4adea756b1165b4cad50da7/Pillow-7.2.0-cp37-cp37m-manylinux1_x86_64.whl
        sha256: 52125833b070791fcb5710fabc640fc1df07d087fc0c0f02d3661f76c23c5b8b
        type: file

  - name: pdfarranger
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} .
    sources:
      - url: https://github.com/jeromerobert/pdfarranger
        tag: 1.6.0
        commit: 7adfef62eae031970fb5c208288bcad672f59f17
        type: git

cleanup:
  - /include
  - /lib/pkgconfig
  - /app/lib/openjpeg-2.3
  - /app/bin/opj_*
